<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Catalogue de formations — PDF</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .card-hover:hover { transform: translateY(-6px); box-shadow: 0 10px 25px rgba(0,0,0,0.08); }
  </style>
</head>
<body class="bg-slate-50 text-slate-800 min-h-screen">
  <header class="bg-white border-b py-6">
    <div class="max-w-6xl mx-auto px-6 flex items-center justify-between">
      <div>
        <h1 class="text-2xl font-extrabold">Catalogue de Formations Rivaldo</h1>
        <p class="text-sm text-slate-500">Consulte et télécharge facilement toutes mes formations PDF. Les fichiers sont hébergés dans le dossier <code>/pdf/</code>.</p>
      </div>
      <div class="text-right">
        <span id="lastUpdated" class="text-sm text-slate-500">Dernière mise à jour : —</span>
      </div>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-6 py-10">
    <div class="flex gap-4 items-center mb-6">
      <input id="search" type="search" placeholder="Chercher une formation..." class="flex-1 border rounded-lg px-4 py-2" />
      <select id="sort" class="border rounded-lg px-3 py-2">
        <option value="new">Trier : du plus récent</option>
        <option value="old">Trier : du plus ancien</option>
        <option value="alpha">Trier : par ordre alphabétique</option>
      </select>
    </div>

    <section id="grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"></section>

    <div class="mt-10 text-center text-sm text-slate-500">
      <p>Les nouvelles mise à jour de formations sont uploadées en PDF sur ce site. <code>/fichiers pdf/</code> Ce site est mise à jour localement par l'administrateur.</p>
    </div>
  </main>

  <footer class="text-center text-xs text-slate-500 py-6">
    © <span id="year"></span> Rivaldo — Catalogue de Formations PDF
  </footer>

  <script>
    const coursesData = [
      {
        "id": "f001",
        "title": "Mise à Jour De La Formation : Marketing TRENDSTAR.",
        "description": "Dernier mise à jour Guide complet pour débuter dans le marketing de réseau TRENDSTAR.",
        "file": "Stratégie_de_réseautage_TRENDSTAR.pdf",
        "thumbnail": "https://images.unsplash.com/photo-1519389950473-47ba0277781c?q=80&w=800&auto=format&fit=crop&ixlib=rb-4.0.3&s=placeholder",
        "updated": "2025-10-10"
      },
      {
        "id": "f002",
        "title": "Formation : Programmation",
        "description": "Accédez ici à des formations de langages de programmation gratuites.",
        "thumbnail": "https://images.unsplash.com/photo-1498050108023-c5249f4df085?q=80&w=800&auto=format&fit=crop",
        "updated": "2025-09-21",
        "link": "programmation.html",
        "zip": "formation-pogrammation.zip"  <!-- ZIP corrigé -->
      }
    ];

    function escapeHtml(s){ return String(s||'').replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

    function renderGrid(data) {
      const grid = document.getElementById('grid');
      grid.innerHTML = '';

      data.forEach(item => {
        const encodedFile = encodeURI(item.file);
        const card = document.createElement('article');
        card.className = 'bg-white rounded-lg overflow-hidden border card-hover';
        card.innerHTML = `
          <img src="${item.thumbnail || 'https://via.placeholder.com/800x450'}" alt="${escapeHtml(item.title)}" class="w-full h-40 object-cover">
          <div class="p-4">
            <h3 class="font-semibold text-lg">${escapeHtml(item.title)}</h3>
            <p class="text-sm text-slate-600 mt-2 line-clamp-3">${escapeHtml(item.description || '')}</p>
            <div class="mt-4 flex items-center justify-between">
              <div class="text-xs text-slate-500">Mis à jour : ${item.updated || '—'}</div>
              <div class="flex gap-2">
                ${item.link 
                  ? `<a href="${item.link}" class="px-3 py-1 rounded text-sm bg-indigo-600 text-white">Ouvrir</a>` 
                  : `<a href="${encodedFile}" target="_blank" rel="noopener" class="px-3 py-1 rounded text-sm border">Voir</a>`}
                ${item.zip 
                  ? `<button onclick="confirmDownload('${item.zip}')" class="px-3 py-1 rounded text-sm bg-indigo-600 text-white">Télécharger tout</button>`
                  : `<a href='${encodedFile}' download class='px-3 py-1 rounded text-sm bg-indigo-600 text-white'>Télécharger</a>`}
              </div>
            </div>
          </div>
        `;
        grid.appendChild(card);
      });
    }

    function filterAndRender() {
      const q = document.getElementById('search').value.trim().toLowerCase();
      const sort = document.getElementById('sort').value;
      let filtered = coursesData.filter(c => (c.title + ' ' + (c.description||'')).toLowerCase().includes(q));

      if (sort === 'new') filtered.sort((a,b) => (b.updated||'').localeCompare(a.updated||''));
      if (sort === 'old') filtered.sort((a,b) => (a.updated||'').localeCompare(b.updated||''));
      if (sort === 'alpha') filtered.sort((a,b) => a.title.localeCompare(b.title));

      renderGrid(filtered);
    }

    document.getElementById('search').addEventListener('input', filterAndRender);
    document.getElementById('sort').addEventListener('change', filterAndRender);

    function updateLastUpdated(data) {
      const dates = data.map(d => d.updated).filter(Boolean).sort();
      const last = dates.length ? dates[dates.length-1] : null;
      document.getElementById('lastUpdated').textContent = last ? `Dernière mise à jour : ${last}` : 'Dernière mise à jour : —';
    }

    document.getElementById('year').textContent = new Date().getFullYear();
    renderGrid(coursesData);
    updateLastUpdated(coursesData);

    // Fonction confirmation Télécharger tout
    function confirmDownload(zipPath) {
      const overlay = document.createElement('div');
      overlay.style.position = 'fixed';
      overlay.style.top = '0';
      overlay.style.left = '0';
      overlay.style.width = '100%';
      overlay.style.height = '100%';
      overlay.style.background = 'rgba(0,0,0,0)';
      overlay.style.display = 'flex';
      overlay.style.alignItems = 'center';
      overlay.style.justifyContent = 'center';
      overlay.style.zIndex = '9999';
      overlay.style.opacity = '0';
      overlay.style.transition = 'opacity 0.3s ease';

      const box = document.createElement('div');
      box.style.background = 'white';
      box.style.padding = '20px';
      box.style.borderRadius = '10px';
      box.style.width = '90%';
      box.style.maxWidth = '400px';
      box.style.textAlign = 'center';
      box.style.transform = 'translateY(-50px) scale(0.7)';
      box.style.transition = 'transform 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55)';

      box.innerHTML = `
        <h3 style="margin-bottom: 10px; font-weight: bold;">Confirmation</h3>
        <p>Voulez-vous télécharger tous les documents de cette section ?</p>
        <div style="margin-top: 15px;">
          <button id="confirmBtn" style="background-color: #2563eb; color: white; padding: 8px 16px; border: none; border-radius: 5px; cursor: pointer; margin-right: 10px;">Confirmer</button>
          <button id="cancelBtn" style="background-color: #ccc; padding: 8px 16px; border: none; border-radius: 5px; cursor: pointer;">Annuler</button>
        </div>
      `;

      overlay.appendChild(box);
      document.body.appendChild(overlay);

      requestAnimationFrame(() => {
        overlay.style.opacity = '1';
        box.style.transform = 'translateY(0) scale(1)';
        overlay.style.background = 'rgba(0,0,0,0.6)';
      });

      function closeOverlay() {
        box.style.transform = 'translateY(-50px) scale(0.7)';
        overlay.style.opacity = '0';
        setTimeout(() => document.body.removeChild(overlay), 500);
      }

      document.getElementById('confirmBtn').onclick = () => {
        const link = document.createElement('a');
        link.href = zipPath;
        link.download = '';
        document.body.appendChild(link);
        link.click();
        link.remove();
        closeOverlay();
      };

      document.getElementById('cancelBtn').onclick = closeOverlay;
    }
  </script>
</body>
</html>
